<!doctype html>
<html>
	<head>
		<title>moomoohk</title>

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Intuitive text input history saving">
<meta name="robots" content="index, follow">

<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@moomoohk" />
<meta name="twitter:title" content="moomoohk" />
<meta name="twitter:description" content="Intuitive text input history saving" />
<meta name="twitter:image" content="/static/images/avatar.png" />

<link rel="shortcut icon" href="/static/images/favicon.ico">
<link rel="stylesheet" href="/static/css/normalize.css">
<link rel="stylesheet" href="/static/css/style.css">
<link rel="stylesheet" href="/static/fonts/mono_social_icons/mono_social_icons.css">

<link href="http://fonts.googleapis.com/css?family=PT+Sans:400italic,400,700italic,700" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Mono" rel="stylesheet" type="text/css">

<script type="application/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script type="application/javascript" src="/static/js/konami/konami.js"></script>
<script type="application/javascript" src="/static/js/highlight/highlight.pack.js"></script>

<link rel="stylesheet" href="/static/js/highlight/styles/xcode.css" />
<link rel="stylesheet" href="/static/dart/slideshow/slideshow.css" />

<script type="application/dart" async src="/static/dart/slideshow/slideshow.dart"></script>
<script async src="/static/dart/packages/browser/dart.js"></script>
<script type="application/javascript">
	hljs.initHighlightingOnLoad();
	$(document).ready(function() {
		/* Oh what's this */
		new Konami(function() {
			var audioElement = document.createElement("audio");
			audioElement.setAttribute("src", "/static/audio/aristotle.m4a");
			audioElement.setAttribute("autoplay", "autoplay");
		});

		setupFooter();
		checkDocumentHeight(setupFooter);
	});

	function checkDocumentHeight(callback) {
		var lastHeight = document.body.clientHeight, newHeight, timer;
		(function run() {
			newHeight = document.body.clientHeight;
			if (lastHeight != newHeight)
				callback();
			lastHeight = newHeight;
			timer = setTimeout(run, 200);
		})();
	}

	function setupFooter() {
		if ($("html").height() > $(window).height()) {
			$("#footer").addClass("returnToTop");
			$("#footer").on("mouseenter", function() {
				$(this).text("Return to top");
			}).on("mouseleave", function() {
				$(this).text("© moomoohk 2014");
			}).on("click", function(event) {
				if (event.which == 1)
					$("html, body").animate({
						scrollTop : 0
					}, 400);
			});
		} else {
			$("#footer").removeClass("returnToTop");
			$("#footer").off("mouseenter mouseleave click");
		}
	}
</script>
		
<link rel="stylesheet" href="/static/css/snippet.css">
<link rel="stylesheet" href="/static/css/share.css">

	</head>
	<body>
		<nav id="main">
	<div id="mobileMenu">
		<img src="/static/images/menu.png" id="menuIcon"/>
		<span id="title">moomoohk</span>
	</div>
	<ul id="topList">
		<li class="title">
			<p unselectable="on">
				moomoohk
			</p>
		</li>
		<li>
			<a href="/index.html">Home</a>
		</li>
		<li>
			<a href="/projects.html">Projects</a>
			<ul>
				<li>
					<a href="/docs/">Documentation</a>
				</li>
				<li>
					<a href="/projects/grame.html">Grame</a>
					<ul>
						<li>
							<a href="/docs/java/grame/">JavaDocs</a>
						</li>
						<li>
							<a href="/projects/grame.html#downloads">Download</a>
						</li>
					</ul>
				</li>
				<li>
					<a href="/projects/marketmaven.html">Market Maven</a>
				</li>
				<li>
					<a href="/projects/reactionkeeper.html">Reaction Keeper</a>
					<ul>
						<li>
							<a href="/projects/reactionkeeper.html#downloads">Download</a>
						</li>
					</ul>
				</li>
				<li>
					<a href="/projects/trackingmanager.html">Tracking Manager</a>
					<ul>
						<li>
							<a href="/trackingmanager.html#downloads">Download</a>
						</li>
					</ul>
				</li>
				<li>
					<a href="/projects/moocommands.html">MooCommands</a>
					<ul>
						<li>
							<a href="/docs/java/moocommands/">JavaDocs</a>
						</li>
						<li>
							<a href="/projects/moocommands.html#downloads">Download</a>
						</li>
					</ul>
				</li>
				<li>
					<a href="/projects/mooconsole.html">MooConsole</a>
					<ul>
						<li>
							<a href="/docs/java/mooconsole/">JavaDocs</a>
						</li>
						<li>
							<a href="/projects/mooconsole.html#downloads">Download</a>
						</li>
					</ul>
				</li>
				<li>
					<a href="/projects/mootilities.html">Mootilities</a>
					<ul>
						<li>
							<a href="/docs/java/mootilities-basic/">JavaDocs (basic)</a>
						</li>
						<li>
							<a href="/docs/java/mootilities-swing/">JavaDocs (swing)</a>
						</li>
						<li>
							<a href="/projects/mootilities.html#downloads">Download</a>
						</li>
					</ul>
				</li>
				<li>
					<a href="/projects/moobootstrap.html">MooBootstrap</a>
					<ul>
						<li>
							<a href="/docs/java/moobootstrap/">JavaDocs</a>
						</li>
						<li>
							<a href="/projects/moobootstrap.html#downloads">Download</a>
						</li>
					</ul>
				</li>
				<li>
					<a href="/projects/geek_code.html">geek_code</a>
					<ul>
						<li>
							<a href="/docs/dart/geek_code/">Dart docs</a>
						</li>
						<li>
							<a href="https://pub.dartlang.org/packages/geek_code">Pub page</a>
						</li>
					</ul>
				</li>
			</ul>
		</li>
		<li>
			<a href="/snippets.html">Snippets</a>
		</li>
		<li>
			<a href="/contact.html">Contact</a>
			<ul>
				<li>
					<a href="http://webchat.freenode.net?channels=%23moomoohk&uio=Mj10cnVlJjQ9dHJ1ZSYxMT0yMzYff/" target="_blank">IRC</a>
				</li>
				<li>
					<a href="http://github.com/moomoohk/" target="_blank">GitHub</a>
				</li>
			</ul>
		</li>
	</ul>
</nav>
		
<section id="snippetHeader">
	<span id="snippet_id">Snippet: input_history</span>
	<a href="/snippets.html" id="indexLink">Index</a>
</section>

		<section>
			
	
<h1>Intuitive text input history saving</h1>

<p>Console windows aren't complete without the ability to save an easily traversible input history.</p>

<p>The technique I describe below isn't only useful in console windows. Chat applications can also utilize it effectively.</p>

<h2>Outline</h2>

<p>Consoles are made up of 2 main GUI components:</p>

<ul>
<li>The text area: Where command output and other information is displayed</li>
<li>The input field: Where the user inputs commands</li>
</ul>

<p>When I use a console interface I expect the following intuitive behavior:</p>

<ul>
<li>The console should save my commands in order of input in a list</li>
<li>I should be able to traverse this list using my up and down arrow keys when the input field is focused</li>
<li>The list should not contain the same value more than once</li>
<li>The console should "stash" the command I'm currently typing out while I traverse the list so I can always go back to it if needed</li>
</ul>

<h2>Code</h2>

<p>Here's code I wrote in <a href="http://dartlang.org/">Dart</a> that achieves all these effects by utilizing key listeners:</p>

<pre><code>List&lt;String&gt; scrollback = [""];
int scrollbackIndex = 0;
InputElement inputField = new InputElement(type: "text");

inputField
    ..onKeyDown.listen((KeyboardEvent event) {
        if (event.keyCode == KeyCode.UP || event.keyCode == KeyCode.DOWN) {
            event.preventDefault();
            if (event.keyCode == KeyCode.UP) scrollbackIndex = min(scrollbackIndex + 1, scrollback.length - 1);
            if (event.keyCode == KeyCode.DOWN) scrollbackIndex = max(scrollbackIndex - 1, 0);
            inputField.value = scrollback[scrollbackIndex];
        }
    })
    ..onKeyUp.listen((KeyboardEvent event) {
        if (KeyCode.isCharacterKey(event.keyCode)) {
            if (scrollbackIndex != 0) scrollbackIndex = 0;
            if (scrollbackIndex == 0) scrollback[0] = inputField.value.trim();
        }
    })
    ..onKeyPress.listen((KeyboardEvent event) {
        String input = inputField.value.replaceAll(new RegExp("\\s+"), " ");
        if (event.keyCode == KeyCode.ENTER &amp;&amp; input.length != 0) {
            scrollback[0] = input;
            int index = scrollback.lastIndexOf(input);
            if (index != 0) scrollback.removeAt(index);
            scrollback.insert(0, "");
            scrollbackIndex = 0;
            inputField.value = "";
            evaluateCommand(input);
        }
    });
</code></pre>

<h3>Variable breakdown</h3>

<ul>
<li><code>scrollback</code> is the list that will store the input history. I use the first index[0] as the "stash" (note that the list is initialized with an empty string at index[0])</li>
<li><code>scrollbackIndex</code> keeps track of our place in the scrollback list as we traverse it</li>
<li><code>inputField</code> is our input text field</li>
</ul>

<h3>Key listener breakdown</h3>

<ul>
<li><code>onKeyDown</code> (fired when a key is depressed):
<ol>
<li>Ensure that the key being depressed is either up or down arrow, if true:</li>
<li>Prevent default key behavior, which is moving the caret to beginning or end of the text in the field (respectively)</li>
<li>Manipulate <code>scrollbackIndex</code> depending on what key was pressed while making sure to constrain it within its bounds (low bound is 0, high bound is <code>scrollback.length - 1</code>)</li>
<li>Set the text in the input field to <code>scrollback[scrollbackIndex]</code>, effectively displaying that command from the scrollback history</li>
</ol></li>
<li><code>onKeyUp</code> (fired when a key is released):
<ol>
<li>Ensure that the key is alphabetical (indicating that the user is typing in the field), if true:</li>
<li>Check if <code>scrollbackIndex</code> isn't 0 (indicating that the user is typing over a command from the history). If true, set <code>scrollbackIndex</code> to 0 (this will ensure that what the user is currently typing gets stashed)</li>
<li>Check if <code>scrollbackIndex</code> is 0 (indicating that the user is working on the stash). If true, trim the text from the input field and put it in the stash</li>
</ol></li>
<li><code>onKeyPressed</code>:
<ol>
<li>Use regex to remove any sequences of spaces that are longer than 1 from the input field text (i.e. " &nbsp; &nbsp; this &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; is a &nbsp; test &nbsp;" will get turned into "this is a test") and save this new value in a variable named <code>input</code>. This is optional, I do it to keep things clean</li>
<li>Check if the key is enter and that <code>input</code> isn't an empty string. If true:</li>
<li>Put <code>input</code> in the stash (in case it isn't already)</li>
<li>Ensure that the value of <code>input</code> doesn't appear more than once in <code>scrollback</code> by removing any doubles</li>
<li>Insert an empty string at index[0] of <code>scrollback</code> effectively committing the command to history and resetting the stash</li>
<li>Set <code>scrollbackIndex</code> to 0</li>
<li>Reset the input field</li>
<li>Evaluate the command using whatever method</li>
</ol></li>
</ul>

<h2>Demo</h2>

<p>Click <a href="input_history/demo.html">here</a> to check out a demo featuring the Dart code above.</p>



		</section>
		
<section>
	<h1>Document Changelog</h1>

	
<ul>
<li>6/12/14: Created</li>
<li>6/12/14: Minor tweaks</li>
</ul>


</section>
<section id="share">
	<span class="shareSpan">Share:</span>
	<a class="share facebook" href="#" onclick="javascript:window.open('https://www.facebook.com/sharer/sharer.php?u=' + encodeURIComponent(location.href) + '&t=TITLE', '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=300,width=600');return false;" target="_blank" title="Share on Facebook">
		<span class="symbol">circlefacebook</span>
	</a>
	<a class="share twitter" href="#" onclick="javascript:window.open('https://twitter.com/share?url=' + encodeURIComponent(location.href) + '&via=moomoohk&text=' + encodeURIComponent('Intuitive text input history saving'), '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=300,width=600');return false;" target="_blank" title="Share on Twitter">
		<span class="symbol">circletwitterbird</span>
	</a>
	<a class="share gplus" href="#" onclick="javascript:window.open('https://plus.google.com/share?url=' + encodeURIComponent(location.href), '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=350,width=480');return false;" target="_blank" title="Share on Google+">
		<span class="symbol">circlegoogleplus</span>
	</a>
	<a class="share reddit" href="#" onclick="javascript:window.open('http://www.reddit.com/submit?url=' + encodeURIComponent(location.href) + '&title=' + encodeURIComponent('Intuitive text input history saving'));return false;" target="_blank" title="Share on Reddit">
		<span class="symbol">circlereddit</span>
	</a>
</section>

		<section id="footer">
	<span>© moomoohk 2016</span>
</section>
	</body>
</html>
