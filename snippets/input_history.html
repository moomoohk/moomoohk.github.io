<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta name="description" content="Intuitive text input history saving">
		<meta name="robots" content="index, follow">

		<meta name="twitter:card" content="summary" />
		<meta name="twitter:site" content="@moomoohk" />
		<meta name="twitter:title" content="moomoohk/snippets/input_history" />
		<meta name="twitter:description" content="Intuitive text input history saving" />
		<meta name="twitter:image" content="../website-template/assets/image/avatar.png" />

		
        <!-- Hammer reload -->
          <script>
            setInterval(function(){
              try {
                if(typeof ws != 'undefined' && ws.readyState == 1){return true;}
                ws = new WebSocket('ws://'+(location.host || 'localhost').split(':')[0]+':35353')
                ws.onopen = function(){ws.onclose = function(){document.location.reload()}}
                ws.onmessage = function(){
                  var links = document.getElementsByTagName('link'); 
                    for (var i = 0; i < links.length;i++) { 
                    var link = links[i]; 
                    if (link.rel === 'stylesheet' && !link.href.match(/typekit/)) { 
                      href = link.href.replace(/((&|\?)hammer=)[^&]+/,''); 
                      link.href = href + (href.indexOf('?')>=0?'&':'?') + 'hammer='+(new Date().valueOf());
                    }
                  }
                }
              }catch(e){}
            }, 1000)
          </script>
        <!-- /Hammer reload -->
      

		<link href="http://fonts.googleapis.com/css?family=PT+Sans:400italic,400,700italic,700" rel="stylesheet" type="text/css">
		<link href='http://fonts.googleapis.com/css?family=PT+Mono' rel='stylesheet' type='text/css'>

		<link rel='stylesheet' href='../website-template/assets/css/normalize.css'>
<link rel='stylesheet' href='../website-template/assets/css/style.css'>
<link rel='stylesheet' href='../website-template/assets/dart/slideshow/slideshow.css'>
		<script src='../website-template/assets/js/jquery-1.8.3.min.js'></script>
<script src='../website-template/assets/js/snaptortoise-konami-js-93c5489/konami.js'></script>
		<script async type="application/dart" src="../website-template/assets/dart/slideshow/slideshow.dart"></script>
		<script async src="assets/input_history/packages/browser/dart.js"></script>

		<link href="../website-template/assets/image/favicon.ico" rel="shortcut icon">
		<title>moomoohk/snippets/input_history</title>
		<script type="application/javascript">
			$(document).ready(function() {
				/* Oh what's this */
				new Konami(function() {
					var audioElement = document.createElement("audio");
					audioElement.setAttribute("src", "../website-template/assets/audio/aristotle.m4a");
					audioElement.setAttribute("autoplay", "autoplay");
				});

				if ($("body").height() > $(window).height()) {
					$("#footer").addClass("returnToTop");
				}

				var textContents = $("#footer").text().trim();
				$("#footer")
				/*.on("mouseenter", function() {
					if ($(this).hasClass("returnToTop"))
						$(this).text("Return to top");
				}).on("mouseleave", function() {
					if ($(this).hasClass("returnToTop"))
						$(this).text(textContents);
				})*/
				.on("click", function(event) {
					if ($(this).hasClass("returnToTop"))
						if (event.which == 1)
							$("html, body").animate({
								scrollTop : 0
							}, 400);
				});

				var eventHandle = function() {
					if ($("body").height() > $(window).height()) {
						$("#footer").addClass("returnToTop");
					} else {
						$("#footer").removeClass("returnToTop");
					}
				};
				if (window.addEventListener) {
					window.addEventListener("resize", eventHandle, false);
				} else if (window.attachEvent) {
					window.attachEvent("onresize", eventHandle);
				} else {
					window["onresize"] = eventHandle;
				}
			});
		</script>
	</head>

	<body>
		<header>
			<nav id="main">
	<div id="mobileMenu">
		<img src="../website-template/assets/image/menu.png" id="menuIcon"/>
		<span id="title">moomoohk</span>
	</div>
	<ul id="topList">
		<li class="title">
			<p unselectable="on">
				moomoohk
			</p>
		</li>
		<li>
			<a href="/index.html">Home</a>
		</li>
		<li>
			<a href="/projects.html">Projects</a>
			<ul>
				<li>
					<a href="/grame/">Grame</a>
					<ul>
						<li>
							<a href="/grame/docs/">JavaDocs</a>
						</li>
						<li>
							<a href="/grame/#downloads">Download</a>
						</li>
					</ul>
				</li>
				<li>
					<a href="/marketmaven.html">Market Maven</a>
				</li>
				<li>
					<a href="/reactionkeeper.html">Reaction Keeper</a>
					<ul>
						<li>
							<a href="/reactionkeeper.html#downloads">Download</a>
						</li>
					</ul>
				</li>
				<li>
					<a href="/trackingmanager.html">Tracking Manager</a>
					<ul>
						<li>
							<a href="/trackingmanager.html#downloads">Download</a>
						</li>
					</ul>
				</li>
				<li>
					<a href="/moocommands/">MooCommands</a>
					<ul>
						<li>
							<a href="/moocommands/docs/">JavaDocs</a>
						</li>
						<li>
							<a href="/moocommands/#downloads">Download</a>
						</li>
					</ul>
				</li>
				<li>
					<a href="/mooconsole/">MooConsole</a>
					<ul>
						<li>
							<a href="/mooconsole/docs/">JavaDocs</a>
						</li>
						<li>
							<a href="/mooconsole/#downloads">Download</a>
						</li>
					</ul>
				</li>
				<li>
					<a href="/mootilities/">Mootilities</a>
					<ul>
						<li>
							<a href="/mootilities/docs/">JavaDocs</a>
						</li>
						<li>
							<a href="/mootilities/#downloads">Download</a>
						</li>
					</ul>
				</li>
				<li>
					<a href="/moobootstrap/">MooBootstrap</a>
					<ul>
						<li>
							<a href="/moobootstrap/docs/">JavaDocs</a>
						</li>
						<li>
							<a href="/moobootstrap/#downloads">Download</a>
						</li>
					</ul>
				</li>
			</ul>
		</li>
		<li>
			<a href="/snippets.html">Snippets</a>
		</li>
		<li>
			<a href="/contact.html">Contact</a>
			<ul>
				<li>
					<a href="http://twitter.com/moomoohk/" target="_blank">Twitter</a>
				</li>
				<li>
					<a href="http://youtube.com/moomoohk/" target="_blank">YouTube</a>
				</li>
				<li>
					<a href="http://webchat.freenode.net?channels=%23moomoohk&uio=Mj10cnVlJjQ9dHJ1ZSYxMT0yMzYff/" target="_blank">IRC</a>
				</li>
				<li>
					<a href="http://github.com/moomoohk/" target="_blank">GitHub</a>
				</li>
			</ul>
		</li>
	</ul>
</nav>
		</header>

<style type="text/css">
	#snippetHeader {
		text-align: center;
		padding: 5px;
		background-color: #B9C2DB;
	}

	#snippetID {
		display: block;
		margin-bottom: 5px;
	}

	#indexLink {
		background-color: #9BA5BE;
		border-bottom-right-radius: 4px;
		border-bottom-left-radius: 4px;
		display: block;
		padding: 5px;
		margin-left: -5px;
		margin-right: -5px;
		margin-bottom: -5px;
		-o-transition: background-color ease .2s;
		-ms-transition: background-color ease .2s;
		-moz-transition: background-color ease .2s;
		-webkit-transition: background-color ease .2s;
		transition: background-color ease .2s;
	}

	#indexLink:hover {
		background-color: #788DC2;
	}
</style>
<section id="snippetHeader">
	<span id="snippetID">Snippet: input_history</span>
	<a href="../snippets.html" id="indexLink">Index</a>
</section>

<section>
  <article>
    <h1>Intuitive text input history saving</h1>
<p>Console windows aren’t complete without the ability to save an easily traversible input history.</p>

<p>This technique is also easily applicable in other situations, like chat apps.</p>

<h2>Outline</h2>
<p>Consoles are made up of 2 main GUI components:</p>

<ul>
  <li>The text area: Where command output and other information is displayed</li>
  <li>The input field: Where the user inputs commands</li>
</ul>

<p>When I use a console interface I expect the following intuitive behavior:</p>

<ul>
  <li>The console should save my commands in order of input in a list</li>
  <li>I should be able to traverse this list using my up and down arrow keys when the input field is focused</li>
  <li>The list should not contain the same value more than once</li>
  <li>The console should “stash” the command I’m currently typing out while I traverse the list so I can always go back to it if needed</li>
</ul>

<h2>Code</h2>
<p>Here’s code I wrote in <a href="http://dartlang.org/">Dart</a> that achieves all these effects by utilizing key listeners:</p>

<pre><code>List&lt;String&gt; scrollback = [""];
int scrollbackIndex = 0;
InputElement inputField = new InputElement(type: "text");

inputField
    ..onKeyDown.listen((KeyboardEvent event) {
        if (event.keyCode == KeyCode.UP || event.keyCode == KeyCode.DOWN) {
            event.preventDefault();
            if (event.keyCode == KeyCode.UP) scrollbackIndex = min(scrollbackIndex + 1, scrollback.length - 1);
            if (event.keyCode == KeyCode.DOWN) scrollbackIndex = max(scrollbackIndex - 1, 0);
            inputField.value = scrollback[scrollbackIndex];
        }
    })
    ..onKeyUp.listen((KeyboardEvent event) {
        if (KeyCode.isCharacterKey(event.keyCode)) {
            if (scrollbackIndex != 0) scrollbackIndex = 0;
            if (scrollbackIndex == 0) scrollback[0] = inputField.value.trim();
        }
    })
    ..onKeyPress.listen((KeyboardEvent event) {
        String input = inputField.value.replaceAll(new RegExp("\\s+"), " ");
        if (event.keyCode == KeyCode.ENTER &amp;&amp; input.length != 0) {
            scrollback[0] = input;
            int index = scrollback.lastIndexOf(input);
            if (index != 0) scrollback.removeAt(index);
            scrollback.insert(0, "");
            scrollbackIndex = 0;
            inputField.value = "";
            evaluateCommand(input);
        }
    });
</code></pre>

<h3>Variable breakdown</h3>
<ul>
  <li><code>scrollback</code> is the list that will store the input history. I use the first index[0] as the “stash” (note that the list is initialized with an empty space at index[0])</li>
  <li><code>scrollbackIndex</code> keeps track of our place in the scrollback list as we traverse it</li>
  <li><code>inputField</code> is our input text field</li>
</ul>

<h3>Key listener breakdown</h3>
<ul>
  <li><code>onKeyDown</code> (fired when a key is depressed):
    <ol>
      <li>Ensure that the key being depressed is either up or down arrow, if true:</li>
      <li>Prevent default key behavior, which is moving the caret to beginning or end of the text in the field (respectively)</li>
      <li>Manipulate <code>scrollbackIndex</code> depending on what key was pressed while making sure to constrain it within its bounds (low bound is 0, high bound is <code>scrollback.length - 1</code>)</li>
      <li>Set the text in the input field to <code>scrollback[scrollbackIndex]</code>, effectively displaying that command from the scrollback history</li>
    </ol>
  </li>
  <li><code>onKeyUp</code> (fired when a key is released):
    <ol>
      <li>Ensure that the key is alphabetical (indicating that the user is typing in the field), if true:</li>
      <li>Check if <code>scrollbackIndex</code> isn’t 0 (indicating that the user is typing over a command from the history). If true, set <code>scrollbackIndex</code> to 0 (this will ensure that what the user is currently typing gets stashed)</li>
      <li>Check if <code>scrollbackIndex</code> is 0 (indicating that the user is working on the stash). If true, trim the text from the input field and put it in the stash</li>
    </ol>
  </li>
  <li><code>onKeyPressed</code>:
    <ol>
      <li>Use regex to remove any sequences of spaces that are longer than 1 from the input field text (i.e. “     this           is a   test  ” will get turned into “this is a test”) and save this new value in a variable named <code>input</code>. This is optional, I do it to keep things clean</li>
      <li>Check if the key is enter and that <code>input</code> isn’t an empty string. If true:</li>
      <li>Put <code>input</code> in the stash (in case it isn’t already)</li>
      <li>Ensure that the value of <code>input</code> doesn’t appear more than once in <code>scrollback</code> by removing any doubles</li>
      <li>Insert an empty string at index[0] of <code>scrollback</code> effectively committing the command to history and resetting the stash</li>
      <li>Reset the input field</li>
      <li>Evaluate the command using whatever method</li>
    </ol>
  </li>
</ul>

<h2>Demo</h2>
<p>Click <a href="assets/input_history/demo.html">here</a> to check out a demo featuring the Dart code above.</p>

  </article>
</section>
<section>
  <h1>Document Changelog</h1>
<ul>
  <li>6/12/14: Created</li>
</ul>

</section>

		<section id="footer">
			<span>© moomoohk 2014</span>
		</section>
	</body>
</html>